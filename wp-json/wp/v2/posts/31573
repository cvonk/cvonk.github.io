{"id":31573,"date":"2015-10-19T17:44:14","date_gmt":"2015-10-20T00:44:14","guid":{"rendered":"https:\/\/coertvonk.com\/?p=31573"},"modified":"2022-04-27T18:02:25","modified_gmt":"2022-04-28T01:02:25","slug":"digitizing-the-analog-signal","status":"publish","type":"post","link":"http:\/\/coertvonk.com\/sw\/arduino\/pitch-detector\/digitizing-the-analog-signal-31573","title":{"rendered":"Digitizing the analog signal"},"content":{"rendered":"<p>\r\n    Describes digitizing the analog signal for pitch detection on Arduino.  How the analog signal from the microphone is digitized. Part of the project <a href=\"\/category\/sw\/pitch-detector\">Arduino Pitch Detector<\/a>.\\(\\)\r\n<\/p>\r\n\r\n<h2>\r\n    Digitizing the analog signal (<code>microphone.cpp<\/code>)\r\n<\/h2>\r\n<p>\r\n    <img  title=\"\" loading=\"lazy\" width=\"200\" height=\"190\" class=\"alignright size-full wp-image-13277\" src=\"https:\/\/coertvonk.com\/wp-content\/uploads\/icon-microphone.jpg\" alt=\"own work\" \/>\r\n\r\n    The microphone driver determines the value presented at the analog port, using analog-to-digital (ADC) conversion. The driver reads the analog port <em>asynchronously<\/em>. In this asynchronous approach, the CPU starts the conversion, and moves on to do other things. Once, the a conversion is complete, the ACD converter interrupts the CPU. The CPU postpones what it is doing, reads the conversion result, and returns to whatever it was doing. This way the the CPU doesn&#8217;t have to wait for the ADC conversion to complete (typically abt. 832 cycles) [<a href=\"https:\/\/meettechniek.info\/embedded\/arduino-analog.html\">Meettechniek, 2013<\/a>].\r\n<\/p>\r\n<p>\r\n    This asynchronous approach, usually requires two buffers. One buffer is written to asynchronously, while the another buffer is being processed. Given that Arduino UNO has a precious 2048 bytes of SDRAM, this code goes through some hoops, so that it only needs one buffer.\r\n<\/p>\r\n<p>\r\n    The typical sequence of events is:\r\n    <ol>\r\n        <li>\r\n            The application needs audio samples and calls <code>Microphone::getSamples()<\/code>.\r\n            <ul>\r\n                <li>The first time <code>getSamples()<\/code> is called, it allocates memory for the samples, and starts the sampling. All other times, the samples are probably already available (started another time in step 3).<\/li>\r\n                <li>The method <code>getSamples()<\/code> waits until all samples are available.<\/li>\r\n            <\/ul>\r\n        <\/li>\r\n        <li>\r\n            The application processes the samples.\r\n        <\/li>\r\n        <li>\r\n            Once the application is done with the samples, it calls <code>Microphone::update()<\/code>.\r\n            <ul>\r\n                <li>This initiates the interrupt driven process of gathering new samples. It does not wait for the samples.<\/li>\r\n            <\/ul>\r\n        <\/li>\r\n        <li>\r\n            The application continues (without accessing the samples) e.g. to display the results.\r\n        <\/li>\r\n        <li>\r\n            Return to step 1.\r\n        <\/li>\r\n    <\/ol>\r\n<\/p>\r\n<p>\r\n    Once the application, determines the frequency, it starts to take new samples while determining the pitch, determining note level segmentation, and displaying the results. This application uses a sample rate of 9615 samples\/s. Refer to <code>autocorr.cpp<\/code> for details.\r\n<\/p>\r\n<p>\r\n    <div class=\"continue-container no-print\">\r\n        <div class=\"continue-content\">\r\n            <div class=\"continue-text\">\r\n                The <a href=\"https:\/\/coertvonk.com\/sw\/arduino\/pitch-detector\/frequency-and-pitch-detection-31575\">next page<\/a> describes one of the key algorithms: finding the frequency and pitch.\r\n        <\/div>\r\n    <\/div>    \r\n<\/p>\r\n","protected":false},"excerpt":{"rendered":"Describes digitizing the analog signal for pitch detection on Arduino.  How the microphone signal is digitized.","protected":false},"author":41,"featured_media":18417,"comment_status":"open","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":{"inline_featured_image":false,"_mi_skip_tracking":false},"categories":[433],"tags":[],"yoast_head":"<!-- This site is optimized with the Yoast SEO plugin v18.6 - https:\/\/yoast.com\/wordpress\/plugins\/seo\/ -->\n<title>Digitizing the analog signal for pitch detection on Arduino - Johan Vonk<\/title>\n<meta name=\"description\" content=\"Describes digitizing the analog signal for pitch detection on Arduino. How the microphone signal is digitized.\" \/>\n<meta name=\"robots\" content=\"index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1\" \/>\n<link rel=\"canonical\" href=\"https:\/\/coertvonk.com\/sw\/arduino\/pitch-detector\/digitizing-the-analog-signal-31573\" \/>\n<meta property=\"og:locale\" content=\"en_US\" \/>\n<meta property=\"og:type\" content=\"article\" \/>\n<meta property=\"og:title\" content=\"Digitizing the analog signal for pitch detection on Arduino - Johan Vonk\" \/>\n<meta property=\"og:description\" content=\"Describes digitizing the analog signal for pitch detection on Arduino. How the microphone signal is digitized.\" \/>\n<meta property=\"og:url\" content=\"https:\/\/coertvonk.com\/sw\/arduino\/pitch-detector\/digitizing-the-analog-signal-31573\" \/>\n<meta property=\"og:site_name\" content=\"Coert Vonk\" \/>\n<meta property=\"article:published_time\" content=\"2015-10-20T00:44:14+00:00\" \/>\n<meta property=\"article:modified_time\" content=\"2022-04-28T01:02:25+00:00\" \/>\n<meta property=\"og:image\" content=\"https:\/\/coertvonk.com\/wp-content\/uploads\/johan-pitch-detector-logo4.png\" \/>\n\t<meta property=\"og:image:width\" content=\"300\" \/>\n\t<meta property=\"og:image:height\" content=\"300\" \/>\n\t<meta property=\"og:image:type\" content=\"image\/png\" \/>\n<meta name=\"twitter:card\" content=\"summary\" \/>\n<meta name=\"twitter:label1\" content=\"Written by\" \/>\n\t<meta name=\"twitter:data1\" content=\"Coert Vonk\" \/>\n\t<meta name=\"twitter:label2\" content=\"Est. reading time\" \/>\n\t<meta name=\"twitter:data2\" content=\"2 minutes\" \/>\n<script type=\"application\/ld+json\" class=\"yoast-schema-graph\">{\"@context\":\"https:\/\/schema.org\",\"@graph\":[{\"@type\":\"WebSite\",\"@id\":\"http:\/\/coertvonk.com\/#website\",\"url\":\"http:\/\/coertvonk.com\/\",\"name\":\"Coert Vonk\",\"description\":\"Embedded Software Engineer\",\"publisher\":{\"@id\":\"http:\/\/coertvonk.com\/#\/schema\/person\/5eeda746b43b88312a0621fdc226c70e\"},\"potentialAction\":[{\"@type\":\"SearchAction\",\"target\":{\"@type\":\"EntryPoint\",\"urlTemplate\":\"http:\/\/coertvonk.com\/?s={search_term_string}\"},\"query-input\":\"required name=search_term_string\"}],\"inLanguage\":\"en-US\"},{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/coertvonk.com\/sw\/arduino\/pitch-detector\/digitizing-the-analog-signal-31573#primaryimage\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/coertvonk.com\/wp-content\/uploads\/johan-pitch-detector-logo4.png\",\"contentUrl\":\"https:\/\/coertvonk.com\/wp-content\/uploads\/johan-pitch-detector-logo4.png\",\"width\":300,\"height\":300},{\"@type\":\"WebPage\",\"@id\":\"https:\/\/coertvonk.com\/sw\/arduino\/pitch-detector\/digitizing-the-analog-signal-31573#webpage\",\"url\":\"https:\/\/coertvonk.com\/sw\/arduino\/pitch-detector\/digitizing-the-analog-signal-31573\",\"name\":\"Digitizing the analog signal for pitch detection on Arduino - Johan Vonk\",\"isPartOf\":{\"@id\":\"http:\/\/coertvonk.com\/#website\"},\"primaryImageOfPage\":{\"@id\":\"https:\/\/coertvonk.com\/sw\/arduino\/pitch-detector\/digitizing-the-analog-signal-31573#primaryimage\"},\"datePublished\":\"2015-10-20T00:44:14+00:00\",\"dateModified\":\"2022-04-28T01:02:25+00:00\",\"description\":\"Describes digitizing the analog signal for pitch detection on Arduino. How the microphone signal is digitized.\",\"breadcrumb\":{\"@id\":\"https:\/\/coertvonk.com\/sw\/arduino\/pitch-detector\/digitizing-the-analog-signal-31573#breadcrumb\"},\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"ReadAction\",\"target\":[\"https:\/\/coertvonk.com\/sw\/arduino\/pitch-detector\/digitizing-the-analog-signal-31573\"]}]},{\"@type\":\"BreadcrumbList\",\"@id\":\"https:\/\/coertvonk.com\/sw\/arduino\/pitch-detector\/digitizing-the-analog-signal-31573#breadcrumb\",\"itemListElement\":[{\"@type\":\"ListItem\",\"position\":1,\"name\":\"Vonk Family\",\"item\":\"https:\/\/coertvonk.com\/\"},{\"@type\":\"ListItem\",\"position\":2,\"name\":\"Software\",\"item\":\"https:\/\/coertvonk.com\/category\/sw\"},{\"@type\":\"ListItem\",\"position\":3,\"name\":\"Arduino\",\"item\":\"https:\/\/coertvonk.com\/category\/sw\/arduino\"},{\"@type\":\"ListItem\",\"position\":4,\"name\":\"Pitch detection\",\"item\":\"https:\/\/coertvonk.com\/category\/sw\/arduino\/pitch-detector\"},{\"@type\":\"ListItem\",\"position\":5,\"name\":\"Digitizing the analog signal\"}]},{\"@type\":\"Article\",\"@id\":\"https:\/\/coertvonk.com\/sw\/arduino\/pitch-detector\/digitizing-the-analog-signal-31573#article\",\"isPartOf\":{\"@id\":\"https:\/\/coertvonk.com\/sw\/arduino\/pitch-detector\/digitizing-the-analog-signal-31573#webpage\"},\"author\":{\"@id\":\"http:\/\/coertvonk.com\/#\/schema\/person\/5eeda746b43b88312a0621fdc226c70e\"},\"headline\":\"Digitizing the analog signal\",\"datePublished\":\"2015-10-20T00:44:14+00:00\",\"dateModified\":\"2022-04-28T01:02:25+00:00\",\"mainEntityOfPage\":{\"@id\":\"https:\/\/coertvonk.com\/sw\/arduino\/pitch-detector\/digitizing-the-analog-signal-31573#webpage\"},\"wordCount\":315,\"commentCount\":0,\"publisher\":{\"@id\":\"http:\/\/coertvonk.com\/#\/schema\/person\/5eeda746b43b88312a0621fdc226c70e\"},\"image\":{\"@id\":\"https:\/\/coertvonk.com\/sw\/arduino\/pitch-detector\/digitizing-the-analog-signal-31573#primaryimage\"},\"thumbnailUrl\":\"https:\/\/coertvonk.com\/wp-content\/uploads\/johan-pitch-detector-logo4.png\",\"articleSection\":[\"Pitch detection\"],\"inLanguage\":\"en-US\"},{\"@type\":[\"Person\",\"Organization\"],\"@id\":\"http:\/\/coertvonk.com\/#\/schema\/person\/5eeda746b43b88312a0621fdc226c70e\",\"name\":\"Coert Vonk\",\"image\":{\"@type\":\"ImageObject\",\"@id\":\"http:\/\/coertvonk.com\/#personlogo\",\"inLanguage\":\"en-US\",\"url\":\"http:\/\/1.gravatar.com\/avatar\/193315b96c6661985694e2ecd91f2996?s=96&d=mm&r=g\",\"contentUrl\":\"http:\/\/1.gravatar.com\/avatar\/193315b96c6661985694e2ecd91f2996?s=96&d=mm&r=g\",\"caption\":\"Coert Vonk\"},\"logo\":{\"@id\":\"http:\/\/coertvonk.com\/#personlogo\"},\"description\":\"Passionately curious and stubbornly persistent. Enjoys to inspire and consult with others to exchange the poetry of logical ideas.\",\"sameAs\":[\"https:\/\/coertvonk.com\"],\"url\":\"http:\/\/coertvonk.com\/author\/cvonk\"}]}<\/script>\n<!-- \/ Yoast SEO plugin. -->","yoast_head_json":{"title":"Digitizing the analog signal for pitch detection on Arduino - Johan Vonk","description":"Describes digitizing the analog signal for pitch detection on Arduino. How the microphone signal is digitized.","robots":{"index":"index","follow":"follow","max-snippet":"max-snippet:-1","max-image-preview":"max-image-preview:large","max-video-preview":"max-video-preview:-1"},"canonical":"https:\/\/coertvonk.com\/sw\/arduino\/pitch-detector\/digitizing-the-analog-signal-31573","og_locale":"en_US","og_type":"article","og_title":"Digitizing the analog signal for pitch detection on Arduino - Johan Vonk","og_description":"Describes digitizing the analog signal for pitch detection on Arduino. How the microphone signal is digitized.","og_url":"https:\/\/coertvonk.com\/sw\/arduino\/pitch-detector\/digitizing-the-analog-signal-31573","og_site_name":"Coert Vonk","article_published_time":"2015-10-20T00:44:14+00:00","article_modified_time":"2022-04-28T01:02:25+00:00","og_image":[{"width":300,"height":300,"url":"https:\/\/coertvonk.com\/wp-content\/uploads\/johan-pitch-detector-logo4.png","type":"image\/png"}],"twitter_card":"summary","twitter_misc":{"Written by":"Coert Vonk","Est. reading time":"2 minutes"},"schema":{"@context":"https:\/\/schema.org","@graph":[{"@type":"WebSite","@id":"http:\/\/coertvonk.com\/#website","url":"http:\/\/coertvonk.com\/","name":"Coert Vonk","description":"Embedded Software Engineer","publisher":{"@id":"http:\/\/coertvonk.com\/#\/schema\/person\/5eeda746b43b88312a0621fdc226c70e"},"potentialAction":[{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":"http:\/\/coertvonk.com\/?s={search_term_string}"},"query-input":"required name=search_term_string"}],"inLanguage":"en-US"},{"@type":"ImageObject","@id":"https:\/\/coertvonk.com\/sw\/arduino\/pitch-detector\/digitizing-the-analog-signal-31573#primaryimage","inLanguage":"en-US","url":"https:\/\/coertvonk.com\/wp-content\/uploads\/johan-pitch-detector-logo4.png","contentUrl":"https:\/\/coertvonk.com\/wp-content\/uploads\/johan-pitch-detector-logo4.png","width":300,"height":300},{"@type":"WebPage","@id":"https:\/\/coertvonk.com\/sw\/arduino\/pitch-detector\/digitizing-the-analog-signal-31573#webpage","url":"https:\/\/coertvonk.com\/sw\/arduino\/pitch-detector\/digitizing-the-analog-signal-31573","name":"Digitizing the analog signal for pitch detection on Arduino - Johan Vonk","isPartOf":{"@id":"http:\/\/coertvonk.com\/#website"},"primaryImageOfPage":{"@id":"https:\/\/coertvonk.com\/sw\/arduino\/pitch-detector\/digitizing-the-analog-signal-31573#primaryimage"},"datePublished":"2015-10-20T00:44:14+00:00","dateModified":"2022-04-28T01:02:25+00:00","description":"Describes digitizing the analog signal for pitch detection on Arduino. How the microphone signal is digitized.","breadcrumb":{"@id":"https:\/\/coertvonk.com\/sw\/arduino\/pitch-detector\/digitizing-the-analog-signal-31573#breadcrumb"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https:\/\/coertvonk.com\/sw\/arduino\/pitch-detector\/digitizing-the-analog-signal-31573"]}]},{"@type":"BreadcrumbList","@id":"https:\/\/coertvonk.com\/sw\/arduino\/pitch-detector\/digitizing-the-analog-signal-31573#breadcrumb","itemListElement":[{"@type":"ListItem","position":1,"name":"Vonk Family","item":"https:\/\/coertvonk.com\/"},{"@type":"ListItem","position":2,"name":"Software","item":"https:\/\/coertvonk.com\/category\/sw"},{"@type":"ListItem","position":3,"name":"Arduino","item":"https:\/\/coertvonk.com\/category\/sw\/arduino"},{"@type":"ListItem","position":4,"name":"Pitch detection","item":"https:\/\/coertvonk.com\/category\/sw\/arduino\/pitch-detector"},{"@type":"ListItem","position":5,"name":"Digitizing the analog signal"}]},{"@type":"Article","@id":"https:\/\/coertvonk.com\/sw\/arduino\/pitch-detector\/digitizing-the-analog-signal-31573#article","isPartOf":{"@id":"https:\/\/coertvonk.com\/sw\/arduino\/pitch-detector\/digitizing-the-analog-signal-31573#webpage"},"author":{"@id":"http:\/\/coertvonk.com\/#\/schema\/person\/5eeda746b43b88312a0621fdc226c70e"},"headline":"Digitizing the analog signal","datePublished":"2015-10-20T00:44:14+00:00","dateModified":"2022-04-28T01:02:25+00:00","mainEntityOfPage":{"@id":"https:\/\/coertvonk.com\/sw\/arduino\/pitch-detector\/digitizing-the-analog-signal-31573#webpage"},"wordCount":315,"commentCount":0,"publisher":{"@id":"http:\/\/coertvonk.com\/#\/schema\/person\/5eeda746b43b88312a0621fdc226c70e"},"image":{"@id":"https:\/\/coertvonk.com\/sw\/arduino\/pitch-detector\/digitizing-the-analog-signal-31573#primaryimage"},"thumbnailUrl":"https:\/\/coertvonk.com\/wp-content\/uploads\/johan-pitch-detector-logo4.png","articleSection":["Pitch detection"],"inLanguage":"en-US"},{"@type":["Person","Organization"],"@id":"http:\/\/coertvonk.com\/#\/schema\/person\/5eeda746b43b88312a0621fdc226c70e","name":"Coert Vonk","image":{"@type":"ImageObject","@id":"http:\/\/coertvonk.com\/#personlogo","inLanguage":"en-US","url":"http:\/\/1.gravatar.com\/avatar\/193315b96c6661985694e2ecd91f2996?s=96&d=mm&r=g","contentUrl":"http:\/\/1.gravatar.com\/avatar\/193315b96c6661985694e2ecd91f2996?s=96&d=mm&r=g","caption":"Coert Vonk"},"logo":{"@id":"http:\/\/coertvonk.com\/#personlogo"},"description":"Passionately curious and stubbornly persistent. Enjoys to inspire and consult with others to exchange the poetry of logical ideas.","sameAs":["https:\/\/coertvonk.com"],"url":"http:\/\/coertvonk.com\/author\/cvonk"}]}},"_links":{"self":[{"href":"http:\/\/coertvonk.com\/wp-json\/wp\/v2\/posts\/31573"}],"collection":[{"href":"http:\/\/coertvonk.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"http:\/\/coertvonk.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"http:\/\/coertvonk.com\/wp-json\/wp\/v2\/users\/41"}],"replies":[{"embeddable":true,"href":"http:\/\/coertvonk.com\/wp-json\/wp\/v2\/comments?post=31573"}],"version-history":[{"count":5,"href":"http:\/\/coertvonk.com\/wp-json\/wp\/v2\/posts\/31573\/revisions"}],"predecessor-version":[{"id":32766,"href":"http:\/\/coertvonk.com\/wp-json\/wp\/v2\/posts\/31573\/revisions\/32766"}],"wp:featuredmedia":[{"embeddable":true,"href":"http:\/\/coertvonk.com\/wp-json\/wp\/v2\/media\/18417"}],"wp:attachment":[{"href":"http:\/\/coertvonk.com\/wp-json\/wp\/v2\/media?parent=31573"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"http:\/\/coertvonk.com\/wp-json\/wp\/v2\/categories?post=31573"},{"taxonomy":"post_tag","embeddable":true,"href":"http:\/\/coertvonk.com\/wp-json\/wp\/v2\/tags?post=31573"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}