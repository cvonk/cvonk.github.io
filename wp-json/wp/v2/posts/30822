{"id":30822,"date":"2015-10-16T18:47:49","date_gmt":"2015-10-17T01:47:49","guid":{"rendered":"https:\/\/coert.vonk.one\/?p=30822"},"modified":"2022-04-29T17:51:49","modified_gmt":"2022-04-30T00:51:49","slug":"messages-exchange-with-arduino-as-master","status":"publish","type":"post","link":"/\/hw\/math-talk\/messages-exchange-with-arduino-as-master-30822","title":{"rendered":"Message protocol on Arduino"},"content":{"rendered":"<p>\r\n    Implements the SPI byte protocol on Arduino to exchange bytes with a FPGA. Written in C for Intel Arduino 101. This page continues the <a href=\"/\/hw\/math-talk\/bytes-exchange-protocol-30814\">protocol description<\/a> of the <a href=\"\/category\/math-talk\">Math Talk<\/a> series. This short section shows an Arduino implementation of a <em>SPI master<\/em>. The Arduino can be either an Arduino 101 or an Arduino UNO R3 that has been modified to run on 3.3V as described in the <a href=\"/\/hw\/math-talk\/hardware-2-30810\">hardware section<\/a>.\r\n<\/p>\r\n\r\n<h2>\r\n    Arduino as Master\r\n<\/h2>\r\n<p>\r\n    The Arduino is blessed with a support library for the serial peripheral interface. This greatly aids the implementation. The code shown below was tested with both types of Arduino. For the slave we used an Altera or Xilinx based <a href=\"/\/hw\/math-talk\/byte-exchange-with-a-fpga-as-slave-30818\">FPGA implementation<\/a> as described on the <a href=\"/\/hw\/math-talk\/byte-exchange-with-a-fpga-as-slave-30818\">next page<\/a>. Refer to <a href=\"/\/hw\/math-talk\/hardware-2-30810\">the first part of this article<\/a> for details about the physical connection. In particular, once more, please read the part about 3.3V versus 5V when using an Arduino UNO R3.\r\n<\/p>\r\n\r\n<h3>\r\n    Sources\r\n<\/h3>\r\n<p>\r\n    The SPI library makes it very straightforward to implement a SPI master. You can clone this project from:\r\n    <div class=\"flex-container tight\">\r\n         <a class=\"hide-anchor\" href=\"https:\/\/github.com\/cvonk\/FPGA_SPI\">\r\n             <img  title=\"\" src=\"https:\/\/socialify.git.ci\/cvonk\/FPGA_SPI\/image?description=1&#038;issues=1&#038;language=1&#038;name=1&#038;owner=1&#038;pattern=Circuit%20Board&#038;stargazers=1&#038;theme=Light\" width=\"500\" \/>\r\n         <\/a>\r\n    <\/div>\r\n    <ul>\r\n        <li>\r\n            <b>SPI Master implementation<\/b>,\r\n            <code><a href=\"https:\/\/github.com\/cvonk\/FPGA_SPI\/blob\/master\/spi_byte_if\/arduino-spi_byte\/arduino-spi_byte.ino\">arduino-spi_byte.ino<\/a><\/code>\r\n        <\/li>\r\n    <\/ul>\r\n<\/p>\r\n<p>\r\n    The Arduino sends an alternating pattern of 0xAA and 0x55 to the FPGA.  On the FPGA, LED[0] will be on when it receives 0xAA.  Consequentially it will blink with 10% duty cycle.  The FPGA always returns 0x55, what is displayed on the serial port.\r\n<\/p>\r\n\r\n<h2>\r\n    Traces\r\n<\/h2>\r\n<p>\r\n    Logic analyzer traces of the Arduino communicating with the FPGA.  We see the <code>SS<\/code> going active, and the FPGA sending a byte over MISO to the Arduino.  The data is sampled on the rising edge of <code>SCLK<\/code>.\r\n<\/p>\r\n<p>\r\n<div class=\"flex-container tight\">\r\n    <figure>\r\n        <a href=\"https:\/\/coert.vonk.one\/wp-content\/uploads\/spi_byte_if.png\"><img src=\"https:\/\/coert.vonk.one\/wp-content\/uploads\/spi_byte_if-1024x443.png\" alt=\"\" width=\"600\" class=\"alignnone size-large wp-image-31798\" srcset=\"https:\/\/coert.vonk.one\/wp-content\/uploads\/spi_byte_if-1024x443.png 1024w, https:\/\/coert.vonk.one\/wp-content\/uploads\/spi_byte_if-400x173.png 400w, https:\/\/coert.vonk.one\/wp-content\/uploads\/spi_byte_if-768x332.png 768w, https:\/\/coert.vonk.one\/wp-content\/uploads\/spi_byte_if-1536x664.png 1536w, https:\/\/coert.vonk.one\/wp-content\/uploads\/spi_byte_if.png 1630w\" sizes=\"(max-width: 706px) 89vw, (max-width: 767px) 82vw, 740px\" \/><\/a>\r\n        <\/a>\r\n        <figcaption>\r\n            SPI exchange of a byte\r\n        <\/figcaption>\r\n    <\/figure>\r\n<\/div>\r\n<\/p>\r\n<p>\r\n    Zoomed out, we see the Arduino receiving three bytes from the FPGA.\r\n<\/p>\r\n<p>\r\n<div class=\"flex-container tight\">\r\n    <figure>\r\n        <a href=\"https:\/\/coert.vonk.one\/wp-content\/uploads\/spi_byte_if-zoomed-out.png\"><img src=\"https:\/\/coert.vonk.one\/wp-content\/uploads\/spi_byte_if-zoomed-out-1024x348.png\" alt=\"\" width=\"600\" class=\"alignnone size-large wp-image-31797\" srcset=\"https:\/\/coert.vonk.one\/wp-content\/uploads\/spi_byte_if-zoomed-out-1024x348.png 1024w, https:\/\/coert.vonk.one\/wp-content\/uploads\/spi_byte_if-zoomed-out-400x136.png 400w, https:\/\/coert.vonk.one\/wp-content\/uploads\/spi_byte_if-zoomed-out-768x261.png 768w, https:\/\/coert.vonk.one\/wp-content\/uploads\/spi_byte_if-zoomed-out-1536x522.png 1536w, https:\/\/coert.vonk.one\/wp-content\/uploads\/spi_byte_if-zoomed-out.png 2019w\" sizes=\"(max-width: 706px) 89vw, (max-width: 767px) 82vw, 740px\" \/><\/a>\r\n        <figcaption>\r\n            SPI exchange of three bytes, zoomed out\r\n        <\/figcaption>\r\n    <\/figure>\r\n<\/div>\r\n<\/p>\r\n<p>\r\n    <div class=\"continue-container no-print\">\r\n        <div class=\"continue-content\">\r\n            <div class=\"continue-text\">\r\n                Following this &#8220;SPI byte protocol on Arduino&#8221;, up next is: <a href=\"/\/hw\/math-talk\/byte-exchange-with-a-fpga-as-slave-30818\">Byte Exchange with a FPGA as Slave<\/a>.\r\n            <\/div>\r\n        <\/div>\r\n    <\/div>    \r\n<\/p>","protected":false},"excerpt":{"rendered":"Chapter 7. Implements the message protocol on the Arduino.","protected":false},"author":41,"featured_media":32835,"comment_status":"open","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":{"inline_featured_image":false,"_mi_skip_tracking":false},"categories":[421],"tags":[],"yoast_head":"<!-- This site is optimized with the Yoast SEO plugin v18.6 - https:\/\/yoast.com\/wordpress\/plugins\/seo\/ -->\n<title>SPI message protocol on Arduino - Coert Vonk<\/title>\n<meta name=\"description\" content=\"Implements the SPI message protocol on Arduino to read and write custom registers on a FPGA.. Written in C for Intel Arduino 101.\" \/>\n<meta name=\"robots\" content=\"index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1\" \/>\n<link rel=\"canonical\" href=\"https:\/\/coert.vonk.one\/hw\/math-talk\/messages-exchange-with-arduino-as-master-30822\" \/>\n<meta property=\"og:locale\" content=\"en_US\" \/>\n<meta property=\"og:type\" content=\"article\" \/>\n<meta property=\"og:title\" content=\"SPI message protocol on Arduino - Coert Vonk\" \/>\n<meta property=\"og:description\" content=\"Implements the SPI message protocol on Arduino to read and write custom registers on a FPGA.. Written in C for Intel Arduino 101.\" \/>\n<meta property=\"og:url\" content=\"https:\/\/coert.vonk.one\/hw\/math-talk\/messages-exchange-with-arduino-as-master-30822\" \/>\n<meta property=\"og:site_name\" content=\"Coert Vonk\" \/>\n<meta property=\"article:published_time\" content=\"2015-10-17T01:47:49+00:00\" \/>\n<meta property=\"article:modified_time\" content=\"2022-04-30T00:51:49+00:00\" \/>\n<meta property=\"og:image\" content=\"https:\/\/coert.vonk.one\/wp-content\/uploads\/spi-logo-mathtalk-small.png\" \/>\n\t<meta property=\"og:image:width\" content=\"200\" \/>\n\t<meta property=\"og:image:height\" content=\"168\" \/>\n\t<meta property=\"og:image:type\" content=\"image\/png\" \/>\n<meta name=\"twitter:card\" content=\"summary\" \/>\n<meta name=\"twitter:label1\" content=\"Written by\" \/>\n\t<meta name=\"twitter:data1\" content=\"Coert Vonk\" \/>\n\t<meta name=\"twitter:label2\" content=\"Est. reading time\" \/>\n\t<meta name=\"twitter:data2\" content=\"1 minute\" \/>\n<script type=\"application\/ld+json\" class=\"yoast-schema-graph\">{\"@context\":\"https:\/\/schema.org\",\"@graph\":[{\"@type\":\"WebSite\",\"@id\":\"https:\/\/coert.vonk.one\/#website\",\"url\":\"https:\/\/coert.vonk.one\/\",\"name\":\"Coert Vonk\",\"description\":\"Embedded Software Engineer\",\"publisher\":{\"@id\":\"https:\/\/coert.vonk.one\/#\/schema\/person\/5eeda746b43b88312a0621fdc226c70e\"},\"potentialAction\":[{\"@type\":\"SearchAction\",\"target\":{\"@type\":\"EntryPoint\",\"urlTemplate\":\"https:\/\/coert.vonk.one\/?s={search_term_string}\"},\"query-input\":\"required name=search_term_string\"}],\"inLanguage\":\"en-US\"},{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/coert.vonk.one\/hw\/math-talk\/messages-exchange-with-arduino-as-master-30822#primaryimage\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/coert.vonk.one\/wp-content\/uploads\/spi-logo-mathtalk-small.png\",\"contentUrl\":\"https:\/\/coert.vonk.one\/wp-content\/uploads\/spi-logo-mathtalk-small.png\",\"width\":200,\"height\":168},{\"@type\":\"WebPage\",\"@id\":\"https:\/\/coert.vonk.one\/hw\/math-talk\/messages-exchange-with-arduino-as-master-30822#webpage\",\"url\":\"https:\/\/coert.vonk.one\/hw\/math-talk\/messages-exchange-with-arduino-as-master-30822\",\"name\":\"SPI message protocol on Arduino - Coert Vonk\",\"isPartOf\":{\"@id\":\"https:\/\/coert.vonk.one\/#website\"},\"primaryImageOfPage\":{\"@id\":\"https:\/\/coert.vonk.one\/hw\/math-talk\/messages-exchange-with-arduino-as-master-30822#primaryimage\"},\"datePublished\":\"2015-10-17T01:47:49+00:00\",\"dateModified\":\"2022-04-30T00:51:49+00:00\",\"description\":\"Implements the SPI message protocol on Arduino to read and write custom registers on a FPGA.. Written in C for Intel Arduino 101.\",\"breadcrumb\":{\"@id\":\"https:\/\/coert.vonk.one\/hw\/math-talk\/messages-exchange-with-arduino-as-master-30822#breadcrumb\"},\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"ReadAction\",\"target\":[\"https:\/\/coert.vonk.one\/hw\/math-talk\/messages-exchange-with-arduino-as-master-30822\"]}]},{\"@type\":\"BreadcrumbList\",\"@id\":\"https:\/\/coert.vonk.one\/hw\/math-talk\/messages-exchange-with-arduino-as-master-30822#breadcrumb\",\"itemListElement\":[{\"@type\":\"ListItem\",\"position\":1,\"name\":\"Vonk Family\",\"item\":\"https:\/\/coert.vonk.one\/\"},{\"@type\":\"ListItem\",\"position\":2,\"name\":\"Hardware\",\"item\":\"https:\/\/coert.vonk.one\/category\/hw\"},{\"@type\":\"ListItem\",\"position\":3,\"name\":\"Math talk\",\"item\":\"https:\/\/coert.vonk.one\/category\/hw\/math-talk\"},{\"@type\":\"ListItem\",\"position\":4,\"name\":\"Message protocol on Arduino\"}]},{\"@type\":\"Article\",\"@id\":\"https:\/\/coert.vonk.one\/hw\/math-talk\/messages-exchange-with-arduino-as-master-30822#article\",\"isPartOf\":{\"@id\":\"https:\/\/coert.vonk.one\/hw\/math-talk\/messages-exchange-with-arduino-as-master-30822#webpage\"},\"author\":{\"@id\":\"https:\/\/coert.vonk.one\/#\/schema\/person\/5eeda746b43b88312a0621fdc226c70e\"},\"headline\":\"Message protocol on Arduino\",\"datePublished\":\"2015-10-17T01:47:49+00:00\",\"dateModified\":\"2022-04-30T00:51:49+00:00\",\"mainEntityOfPage\":{\"@id\":\"https:\/\/coert.vonk.one\/hw\/math-talk\/messages-exchange-with-arduino-as-master-30822#webpage\"},\"wordCount\":295,\"commentCount\":0,\"publisher\":{\"@id\":\"https:\/\/coert.vonk.one\/#\/schema\/person\/5eeda746b43b88312a0621fdc226c70e\"},\"image\":{\"@id\":\"https:\/\/coert.vonk.one\/hw\/math-talk\/messages-exchange-with-arduino-as-master-30822#primaryimage\"},\"thumbnailUrl\":\"https:\/\/coert.vonk.one\/wp-content\/uploads\/spi-logo-mathtalk-small.png\",\"articleSection\":[\"Math talk\"],\"inLanguage\":\"en-US\"},{\"@type\":[\"Person\",\"Organization\"],\"@id\":\"https:\/\/coert.vonk.one\/#\/schema\/person\/5eeda746b43b88312a0621fdc226c70e\",\"name\":\"Coert Vonk\",\"image\":{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/coert.vonk.one\/#personlogo\",\"inLanguage\":\"en-US\",\"url\":\"http:\/\/1.gravatar.com\/avatar\/193315b96c6661985694e2ecd91f2996?s=96&d=mm&r=g\",\"contentUrl\":\"http:\/\/1.gravatar.com\/avatar\/193315b96c6661985694e2ecd91f2996?s=96&d=mm&r=g\",\"caption\":\"Coert Vonk\"},\"logo\":{\"@id\":\"https:\/\/coert.vonk.one\/#personlogo\"},\"description\":\"Passionately curious and stubbornly persistent. Enjoys to inspire and consult with others to exchange the poetry of logical ideas.\",\"sameAs\":[\"https:\/\/coert.vonk.one\"],\"url\":\"/\/author\/cvonk\"}]}<\/script>\n<!-- \/ Yoast SEO plugin. -->","yoast_head_json":{"title":"SPI message protocol on Arduino - Coert Vonk","description":"Implements the SPI message protocol on Arduino to read and write custom registers on a FPGA.. Written in C for Intel Arduino 101.","robots":{"index":"index","follow":"follow","max-snippet":"max-snippet:-1","max-image-preview":"max-image-preview:large","max-video-preview":"max-video-preview:-1"},"canonical":"https:\/\/coert.vonk.one\/hw\/math-talk\/messages-exchange-with-arduino-as-master-30822","og_locale":"en_US","og_type":"article","og_title":"SPI message protocol on Arduino - Coert Vonk","og_description":"Implements the SPI message protocol on Arduino to read and write custom registers on a FPGA.. Written in C for Intel Arduino 101.","og_url":"https:\/\/coert.vonk.one\/hw\/math-talk\/messages-exchange-with-arduino-as-master-30822","og_site_name":"Coert Vonk","article_published_time":"2015-10-17T01:47:49+00:00","article_modified_time":"2022-04-30T00:51:49+00:00","og_image":[{"width":200,"height":168,"url":"https:\/\/coert.vonk.one\/wp-content\/uploads\/spi-logo-mathtalk-small.png","type":"image\/png"}],"twitter_card":"summary","twitter_misc":{"Written by":"Coert Vonk","Est. reading time":"1 minute"},"schema":{"@context":"https:\/\/schema.org","@graph":[{"@type":"WebSite","@id":"https:\/\/coert.vonk.one\/#website","url":"https:\/\/coert.vonk.one\/","name":"Coert Vonk","description":"Embedded Software Engineer","publisher":{"@id":"https:\/\/coert.vonk.one\/#\/schema\/person\/5eeda746b43b88312a0621fdc226c70e"},"potentialAction":[{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":"https:\/\/coert.vonk.one\/?s={search_term_string}"},"query-input":"required name=search_term_string"}],"inLanguage":"en-US"},{"@type":"ImageObject","@id":"https:\/\/coert.vonk.one\/hw\/math-talk\/messages-exchange-with-arduino-as-master-30822#primaryimage","inLanguage":"en-US","url":"https:\/\/coert.vonk.one\/wp-content\/uploads\/spi-logo-mathtalk-small.png","contentUrl":"https:\/\/coert.vonk.one\/wp-content\/uploads\/spi-logo-mathtalk-small.png","width":200,"height":168},{"@type":"WebPage","@id":"https:\/\/coert.vonk.one\/hw\/math-talk\/messages-exchange-with-arduino-as-master-30822#webpage","url":"https:\/\/coert.vonk.one\/hw\/math-talk\/messages-exchange-with-arduino-as-master-30822","name":"SPI message protocol on Arduino - Coert Vonk","isPartOf":{"@id":"https:\/\/coert.vonk.one\/#website"},"primaryImageOfPage":{"@id":"https:\/\/coert.vonk.one\/hw\/math-talk\/messages-exchange-with-arduino-as-master-30822#primaryimage"},"datePublished":"2015-10-17T01:47:49+00:00","dateModified":"2022-04-30T00:51:49+00:00","description":"Implements the SPI message protocol on Arduino to read and write custom registers on a FPGA.. Written in C for Intel Arduino 101.","breadcrumb":{"@id":"https:\/\/coert.vonk.one\/hw\/math-talk\/messages-exchange-with-arduino-as-master-30822#breadcrumb"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https:\/\/coert.vonk.one\/hw\/math-talk\/messages-exchange-with-arduino-as-master-30822"]}]},{"@type":"BreadcrumbList","@id":"https:\/\/coert.vonk.one\/hw\/math-talk\/messages-exchange-with-arduino-as-master-30822#breadcrumb","itemListElement":[{"@type":"ListItem","position":1,"name":"Vonk Family","item":"https:\/\/coert.vonk.one\/"},{"@type":"ListItem","position":2,"name":"Hardware","item":"https:\/\/coert.vonk.one\/category\/hw"},{"@type":"ListItem","position":3,"name":"Math talk","item":"https:\/\/coert.vonk.one\/category\/hw\/math-talk"},{"@type":"ListItem","position":4,"name":"Message protocol on Arduino"}]},{"@type":"Article","@id":"https:\/\/coert.vonk.one\/hw\/math-talk\/messages-exchange-with-arduino-as-master-30822#article","isPartOf":{"@id":"https:\/\/coert.vonk.one\/hw\/math-talk\/messages-exchange-with-arduino-as-master-30822#webpage"},"author":{"@id":"https:\/\/coert.vonk.one\/#\/schema\/person\/5eeda746b43b88312a0621fdc226c70e"},"headline":"Message protocol on Arduino","datePublished":"2015-10-17T01:47:49+00:00","dateModified":"2022-04-30T00:51:49+00:00","mainEntityOfPage":{"@id":"https:\/\/coert.vonk.one\/hw\/math-talk\/messages-exchange-with-arduino-as-master-30822#webpage"},"wordCount":295,"commentCount":0,"publisher":{"@id":"https:\/\/coert.vonk.one\/#\/schema\/person\/5eeda746b43b88312a0621fdc226c70e"},"image":{"@id":"https:\/\/coert.vonk.one\/hw\/math-talk\/messages-exchange-with-arduino-as-master-30822#primaryimage"},"thumbnailUrl":"https:\/\/coert.vonk.one\/wp-content\/uploads\/spi-logo-mathtalk-small.png","articleSection":["Math talk"],"inLanguage":"en-US"},{"@type":["Person","Organization"],"@id":"https:\/\/coert.vonk.one\/#\/schema\/person\/5eeda746b43b88312a0621fdc226c70e","name":"Coert Vonk","image":{"@type":"ImageObject","@id":"https:\/\/coert.vonk.one\/#personlogo","inLanguage":"en-US","url":"http:\/\/1.gravatar.com\/avatar\/193315b96c6661985694e2ecd91f2996?s=96&d=mm&r=g","contentUrl":"http:\/\/1.gravatar.com\/avatar\/193315b96c6661985694e2ecd91f2996?s=96&d=mm&r=g","caption":"Coert Vonk"},"logo":{"@id":"https:\/\/coert.vonk.one\/#personlogo"},"description":"Passionately curious and stubbornly persistent. Enjoys to inspire and consult with others to exchange the poetry of logical ideas.","sameAs":["https:\/\/coert.vonk.one"],"url":"/\/author\/cvonk"}]}},"_links":{"self":[{"href":"/\/wp-json\/wp\/v2\/posts\/30822"}],"collection":[{"href":"/\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"/\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"/\/wp-json\/wp\/v2\/users\/41"}],"replies":[{"embeddable":true,"href":"/\/wp-json\/wp\/v2\/comments?post=30822"}],"version-history":[{"count":10,"href":"/\/wp-json\/wp\/v2\/posts\/30822\/revisions"}],"predecessor-version":[{"id":32832,"href":"/\/wp-json\/wp\/v2\/posts\/30822\/revisions\/32832"}],"wp:featuredmedia":[{"embeddable":true,"href":"/\/wp-json\/wp\/v2\/media\/32835"}],"wp:attachment":[{"href":"/\/wp-json\/wp\/v2\/media?parent=30822"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"/\/wp-json\/wp\/v2\/categories?post=30822"},{"taxonomy":"post_tag","embeddable":true,"href":"/\/wp-json\/wp\/v2\/tags?post=30822"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}